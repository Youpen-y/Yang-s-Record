`Snabb` —— 一个用于在**用户空间**开发**网络功能**的工具包。
- 网络功能（`network function`），对网络流量执行某些操作的任何程序。（如，读数据包/修改其标头/创建新数据包/丢弃数据包/转发数据包）
	- 过滤功能（即，防火墙）：读取传入数据包，与规则表比较并执行操作（_forward_ 或 _drop_）。
	- 流量映射（即，NAT）：读取传入数据包、修改标头并转发数据包。
	- 封装（即，VPN）：读取传入数据包，创建新数据包，将数据包嵌入到新数据包中并发送。
- 用户空间网络（趋势—在用户空间中写下整个网络功能，不将任何处理留给内核）
	传统上，我们使用操作系统提供的抽象来编写网络功能，操作系统的目标是提供底层硬件的抽象。
	如，处理HDD时，无需考虑磁头、柱面和扇区，而是使用更高级别的抽象：文件系统；网络领域，我们不直接处理 NIC ，而是使用 socket 以及 API 来处理TCP/IP堆栈。
	这种抽象隐式地增加了网络功能处理的开销，第一个缺点是函数被分为两个区域：用户空间和内核空间，并且在两个区域之间切换是有成本的。即使我们将尽可能多的逻辑移至内核，内核的网络层也会带来继承成本。

	硬件的不断改进（RDMA）引发绕过内核而完全在用户空间实现 network functions 的需求。

通常 NIC 的工作方式是将传入数据包放入队列或缓冲区中。该缓冲区实际上是一个 Ring Buffer ，这意味着有两个索引指向该缓冲区，`Rx` 和 `Tx` 。
- 当新的数据包到达时，该数据包被写入 `Rx` 位置并且索引被更新。
- 当数据包离开缓冲区时，会在 `Tx` 位置读取该数据包，并在读取后更新索引。网络函数从 `Tx` 索引获取数据包处理。
- 如果处理数据包的速度太慢，`Rx` 光标最终将超过 `Tx` 光标。当这种情况发生时，就会出现**数据包丢失** （数据包在被消耗之前被覆盖）

用户空间网络需要绕过内核的网络层，这样它就可以充分利用底层硬件的所有性能。几种策略：
- 用户空间驱动程序
- `PF_RING`
- `Netmap`
`Snabb` 选择直接处理硬件，这意味着为其支持的 NIC 提供用户空间驱动程序。

> Snabb 主要提供对 Intel 卡的支持（尽管也支持一些 Solarflare 和 Mellanox 型号）。无论是在内核空间还是用户空间实现驱动程序都不是一件容易的事。访问供应商的数据表（通常是非常大的文档）以了解如何初始化 NIC、如何从中读取数据包、如何传输数据等至关重要。Intel 提供了此类数据表。事实上，英特尔几年前启动了一个具有类似目标的项目：DPDK。 DPDK 是一个在用户空间实现驱动程序的开源项目。虽然最初它只提供英特尔网卡的驱动程序，但随着该项目采用的增加，其他供应商也开始为其硬件添加驱动程序。

---
`Snabb` 内部

- `Engine` - 运行网络功能（`network functions`）
- `Libraries` - 简化网络功能的开发
- `Apps` - 操作数据包的可重用软件组件
- `Programs` - 即用型（ready-to-use）独立网络功能
`Snabb` 中的网络功能是通过链接连接在一起的应用程序的组合。`Snabb` 引擎负责向应用程序图表提供数据包，并为每个应用程序提供执行的机会。
引擎按广度处理应用程序图，广度（breadth） 由两个步骤组成：
- `Inhale` - 将数据包放入图表中
- `Process` - 每个应用程序都有机会接收数据包并操作它们










